<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerraFirma</title>

    <!-- Adicione o link para a biblioteca do FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <link rel="icon" href="/TerraFirma/Pagina_inicial/Imagens/favicon-32x32.png" type="image/x-icon">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet" href="css/Cadastro_Voluntario.css">
</head>

<body>
    <div class="Tela_de_Cadastro_Voluntario">
        <div class="Parte_Esqueda">
            <a href="index.html">
                <button class="Botao_de_retorno">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </a>
            <img src="assets/imgs/Imagem_Lateral_Cadastro_Voluntario.png" alt="Imagem_Lateral_Cadastro_Voluntario"
                class="Imagem_Lateral_Cadastro_Voluntario">
        </div>
        <div class="Parte_Direita">
            <h1 class="Titulo_Cadastro_Voluntario">Cadastro de Voluntario</h1>
            <div class="Inputs">

                <section class="Inputs_Esquerda">

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Nome</p>
                        <input type="text" id="Input_Nome" class="Input" placeholder="Nome">
                        <p class="Campo_Invalido" id="Campo_Erro_Nome"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Estado</p>
                        <select class="Input" id="Input_Estado">
                            <option value="Selecione">Selecione um estado</option>
                        </select>
                        <p class="Campo_Invalido" id="Campo_Erro_Estado"></p>
                    </div>
                    
                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Zona</p>
                        <select class="Input" id="Input_Zona">
                            <option value="Selecione">Selecione a zona onde você mora</option>
                        </select>
                        <p class="Campo_Invalido" id="Campo_Erro_Zona"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Senha</p>
                        <input type="password" id="Input_Senha" class="Input" placeholder="Senha">
                        <p class="Campo_Invalido" id="Campo_Erro_Senha"></p>
                    </div>

                </section>

                <section class="Inputs_Direita">

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Email</p>
                        <input type="text" id="Input_Email" class="Input" placeholder="Email">
                        <p class="Campo_Invalido" id="Campo_Erro_Email"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Cidade</p>
                        <select id="Input_Cidade" class="Input">
                            <option value="Selecione">Selecione uma cidade</option>
                        </select>
                        <p class="Campo_Invalido" id="Campo_Erro_Cidade"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Telefone</p>
                        <input type="text" id="Input_Telefone" class="Input" placeholder="Telefone: XXXXXXXXX">
                        <p class="Campo_Invalido" id="Campo_Erro_Telefone"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Confirmar Senha</p>
                        <input type="password" id="Input_Confirmacao_de_senha" class="Input" placeholder="Confirmar Senha">
                        <p class="Campo_Invalido" id="Campo_Erro_Confirmar_Senha"></p>
                    </div>

                </section>
            </div>
            <div class="Botões">
                <a href="">
                    <button class="Botao_Cadastrar" onclick="Cadastrar()">Cadastrar</button>
                </a>
                <a href="">
                    <button class="Botao_Entrar_Voluntario">Entrar como <span style="color: rgb(25, 0, 255); font-weight: bold;">Voluntario</span></button>
                </a>
            </div>
        </div>
    </div>
</body>
</html>
<script>
    const Estados = [
        "Acre", "Alagoas", "Amapá", "Amazonas", "Bahia", "Ceará",
        "Distrito Federal", "Espírito Santo", "Goiás", "Maranhão",
        "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Pará",
        "Paraíba", "Paraná", "Pernambuco", "Piauí", "Rio de Janeiro",
        "Rio Grande do Norte", "Rio Grande do Sul", "Rondônia", "Roraima",
        "Santa Catarina", "São Paulo", "Sergipe", "Tocantins"
    ];

    const selectEstados = Input_Estado;

    for (let Posicao = 0; Posicao < Estados.length; Posicao++) {
        const option = document.createElement('option');
        option.text = Estados[Posicao];
        option.value = Posicao+1;
        selectEstados.appendChild(option);
    }

    const cidades = [
        "São Paulo", "Rio de Janeiro", "Brasília", "Salvador", "Fortaleza",
        "Belo Horizonte", "Manaus", "Curitiba", "Recife", "Porto Alegre",
        "Goiânia", "Belém", "Guarulhos", "Campinas", "São Luís"
    ];

    const selectCidades = Input_Cidade;

    for (let Posicao = 0; Posicao < cidades.length; Posicao++) {
        const option = document.createElement('option');
        option.text = cidades[Posicao];
        option.value = Posicao+1;
        selectCidades.appendChild(option);
    }

    const Zonas = ["Zona Sul", "Zona Norte", "Zona Leste", "Zona Oeste", "Centro"];

    const selectZona = Input_Zona;

    for (let Posicao = 0; Posicao < Zonas.length; Posicao++) {
        const option = document.createElement('option');
        option.text = Zonas[Posicao];
        option.value = Posicao+1;
        selectZona.appendChild(option);
    }

    function Cadastrar(){

        const NOME = Input_Nome.value;
        const ESTADO = Input_Estado.value;
        const ZONA = Input_Zona.value;
        const SENHA = Input_Senha.value;
        const EMAIL = Input_Email.value;
        const CIDADE = Input_Cidade.value;
        const TELEFONE = Input_Telefone.value;
        const CONFIRMACAO_SENHA = Input_Confirmacao_de_senha.value;


        const fields = [
            { element: Input_Nome, errorElement: Campo_Erro_Nome },
            { element: Input_Estado, errorElement: Campo_Erro_Estado },
            { element: Input_Zona, errorElement: Campo_Erro_Zona},
            { element: Input_Senha, errorElement: Campo_Erro_Senha },
            { element: Input_Telefone, errorElement: Campo_Erro_Telefone },
            { element: Input_Email, errorElement: Campo_Erro_Email },
            { element: Input_Cidade, errorElement: Campo_Erro_Cidade },
            { element: Input_Confirmacao_de_senha, errorElement: Campo_Erro_Confirmar_Senha }
        ];

        fields.forEach(field => {
            field.element.style.border = "";
            field.errorElement.innerHTML = "";
        });

        let Qnt_Campo_Errado = 0

        if (!NOME) {
            Qnt_Campo_Errado++;
            Input_Nome.style.border = "1px solid red";
            Campo_Erro_Nome.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        if (EMAIL) {
            if (EMAIL.indexOf('@') === -1 || EMAIL.indexOf('.') === -1 || EMAIL.length > 264) {
                Qnt_Campo_Errado++;
                Input_Email.style.border = "1px solid red";
                Campo_Erro_Email.innerHTML = "E-mail inválido! Deve conter '@', '.' e deve ser menor que 264 caracteres";
                Campo_Erro_Email.style.display = "block";
                event.preventDefault();
            }
        } else {
            Qnt_Campo_Errado++;
            Input_Email.style.border = "1px solid red";
            Campo_Erro_Email.innerHTML = "O campo não pode estar vazio!";
            Campo_Erro_Email.style.display = "block";
            event.preventDefault();
        }

        if (ESTADO === "Selecione") {
            Qnt_Campo_Errado++;
            Input_Estado.style.border = "1px solid red";
            Campo_Erro_Estado.innerHTML = "Selecione uma opção!";
            event.preventDefault();
        }

        if (CIDADE === "Selecione") {
            Qnt_Campo_Errado++;
            Input_Cidade.style.border = "1px solid red";
            Campo_Erro_Cidade.innerHTML = "Selecione uma opção!";
            event.preventDefault();
        }

        if (ZONA === "Selecione") {
            Qnt_Campo_Errado++;
            Input_Zona.style.border = "1px solid red";
            Campo_Erro_Zona.innerHTML = "Selecione uma opção!";
            event.preventDefault();
        }

        if (TELEFONE) {
            if(TELEFONE.length != 9) {
                Qnt_Campo_Errado++;
                Input_Telefone.style.border = "1px solid red";
                Campo_Erro_Telefone.innerHTML = "Telefone invalido! Deve conter 9 digitos e apenas numeros!";
                event.preventDefault();
            }
        }
        else {
            Qnt_Campo_Errado++;
            Input_Telefone.style.border = "1px solid red";
            Campo_Erro_Telefone.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        const senhaRegex = /^(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})/;
        if (SENHA) {
            if (!senhaRegex.test(SENHA)) {
                Qnt_Campo_Errado++;
                Input_Senha.style.border = "1px solid red";  
                Campo_Erro_Senha.innerHTML = "Senha inválida! Deve conter pelo menos 8 dígitos, 1 número e 1 caractere especial.";
                event.preventDefault();
            } 
        }        
        else {
            Qnt_Campo_Errado++;
            Input_Senha.style.border = "1px solid red";
            Campo_Erro_Senha.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        if(CONFIRMACAO_SENHA){
            if(CONFIRMACAO_SENHA != SENHA){
                Qnt_Campo_Errado++;
                Input_Confirmacao_de_senha.style.border = "1px solid red";
                Campo_Erro_Confirmar_Senha.innerHTML = "Senhas não incompatíveis!";
                event.preventDefault();
            }
        }
        else{
            Qnt_Campo_Errado++;
            Input_Confirmacao_de_senha.style.border = "1px solid red";
            Campo_Erro_Confirmar_Senha.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }
        if(Qnt_Campo_Errado == 0){
            fetch("/Voluntarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    Nome: NOME,
                    Email: EMAIL,
                    Telefone: TELEFONE,
                    Senha: SENHA,
                    fkEstado: ESTADO,
                    fkCidade: CIDADE,
                    fkZona: ZONA
                }),
                })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
              

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

                return false;
        }

    }
</script>