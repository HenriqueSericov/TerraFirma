<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerraFirma</title>

    <!-- Adicione o link para a biblioteca do FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <link rel="icon" href="/TerraFirma/Pagina_inicial/Imagens/favicon-32x32.png" type="image/x-icon">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet" href="css/Cadastro_ONG.css">
    <script src="js/sessao.js"></script>
</head>

<body>
    <div class="Tela_de_Cadastro_ONG">
        <div class="Parte_Esqueda">
            <a href="\TerraFirma\Pagina_inicial\Pagina_inicial.html">
                <button class="Botao_de_retorno">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </a>
            <img src="assets/imgs/Imagem_Lateral_Cadastro_ONG.png" alt="Imagem_Lateral_Cadastro_ONG"
                class="Imagem_Lateral_Cadastro_ONG">
        </div>
        <div class="Parte_Direita">
            <h1 class="Titulo_Cadastro_ONG">Cadastro de ONG</h1>
            <div class="Inputs">

                <section class="Inputs_Esquerda">

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Nome da ONG</p>
                        <input type="text" id="Input_Nome_ONG" class="Input" placeholder="Nome">
                        <p class="Campo_Invalido" id="Campo_Erro_Nome_ONG"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">CNPJ</p>
                        <input type="text" id="Input_CNPJ" class="Input" placeholder="CNPJ: XXXXXXXXXXXXXX">
                        <p class="Campo_Invalido" id="Campo_Erro_CNPJ"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Estado</p>
                        <select class="Input" id="Input_Estado">
                            <option value="Selecione">Selecione um estado</option>
                        </select>
                        <p class="Campo_Invalido" id="Campo_Erro_Estado"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Cidade</p>
                        <select id="Input_Cidade" class="Input">
                            <option value="Selecione">Selecione uma cidade</option>
                        </select>
                        <p class="Campo_Invalido" id="Campo_Erro_Cidade"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Senha</p>
                        <input type="password" id="Input_Senha" class="Input" placeholder="Senha">
                        <p class="Campo_Invalido" id="Campo_Errado_Senha"></p>
                    </div>

                </section>

                <section class="Inputs_Direita">

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Telefone</p>
                        <input type="text" id="Input_Telefone" class="Input" placeholder="Telefone: XXXXXXXXX">
                        <p class="Campo_Invalido" id="Campo_Errado_Telefone"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Email Profissional</p>
                        <input type="text" id="Input_Email" class="Input" placeholder="Email">
                        <p class="Campo_Invalido" id="Campo_Errado_Email"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Tipo de ONG</p>
                        <select class="Input" id="Input_Tipo_ONG">
                            <option value="Selecione">Selecione um tipo de ONG</option>
                        </select>
                        <p class="Campo_Invalido" id="Campo_Errado_Tipo_ONG"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Endereço</p>
                        <input type="text" id="Input_Endereco" class="Input" placeholder="Rua: XXXXXXXXX 00">
                        <p class="Campo_Invalido" id="Campo_Errado_Endereco"></p>
                    </div>

                    <div class="Conjunto_Input">
                        <p class="Nome_Input">Confirmar Senha</p>
                        <input type="password" id="Input_Confirmacao_de_senha" class="Input" placeholder="Confirmar Senha">
                        <p class="Campo_Invalido" id="Campo_Errado_Confirmar_Senha"></p>
                    </div>

                </section>
            </div>
            <div class="Botões">
                <a href="">
                    <button class="Botao_Cadastrar" onclick="Cadastrar()">Cadastrar</button>
                </a>
                <a href="">
                    <button class="Botao_Entrar_ONG">Entrar como <span style="color: rgb(25, 0, 255); font-weight: bold;">ONG</span></button>
                </a>
            </div>
        </div>
    </div>
</body>
</html>
<script>
    const Estados = [
        "Acre", "Alagoas", "Amapá", "Amazonas", "Bahia", "Ceará",
        "Distrito Federal", "Espírito Santo", "Goiás", "Maranhão",
        "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Pará",
        "Paraíba", "Paraná", "Pernambuco", "Piauí", "Rio de Janeiro",
        "Rio Grande do Norte", "Rio Grande do Sul", "Rondônia", "Roraima",
        "Santa Catarina", "São Paulo", "Sergipe", "Tocantins"
    ];

    const selectEstados = Input_Estado;

    for (let i = 0; i < Estados.length; i++) {
        const option = document.createElement('option');
        option.text = Estados[i];
        option.value = Estados[i];
        selectEstados.appendChild(option);
    }

    const cidades = [
        "São Paulo", "Rio de Janeiro", "Brasília", "Salvador", "Fortaleza",
        "Belo Horizonte", "Manaus", "Curitiba", "Recife", "Porto Alegre",
        "Goiânia", "Belém", "Guarulhos", "Campinas", "São Luís"
    ];

    const selectCidades = Input_Cidade;

    for (let i = 0; i < cidades.length; i++) {
        const option = document.createElement('option');
        option.text = cidades[i];
        option.value = cidades[i];
        selectCidades.appendChild(option);
    }

    const tiposONG = [
        "Ambiental", "Educação", "Saúde", "Direitos Humanos", "Assistência Social",
        "Cultura", "Desenvolvimento Comunitário", "Defesa Animal", "Desenvolvimento Sustentável",
        "Habitat", "Desenvolvimento Urbano", "Esportes", "Arte e Cultura", "Outros"
    ];

    const selectTipoONG = Input_Tipo_ONG;

    for (let i = 0; i < tiposONG.length; i++) {
        const option = document.createElement('option');
        option.text = tiposONG[i];
        option.value = tiposONG[i];
        selectTipoONG.appendChild(option);
    }


    function Cadastrar() {
        Input_Nome_ONG.value = "Teste"
        Input_CNPJ.value = 12345678901234
        Input_Senha.value = "12345678@"
        Input_Telefone.value = 123456789
        Input_Email.value = "@."
        Input_Tipo_ONG.value = "Teste"
        Input_Endereco.value = "Rua Teste"
        Input_Confirmacao_de_senha.value = "12345678@"

        const NOME_ONG = Input_Nome_ONG.value
        const CNPJ = Input_CNPJ.value
        const ESTADO = Input_Estado.value
        const CIDADE = Input_Cidade.value
        const SENHA = Input_Senha.value
        const TELEFONE = Input_Telefone.value
        const EMAIL = Input_Email.value
        const TIPO_ONG = Input_Tipo_ONG.value
        const ENDERECO = Input_Endereco.value
        const CONFIRMACAO_SENHA= Input_Confirmacao_de_senha.value


        let Qnt_Campo_Errado = 0


        // Reset all fields' styles
        const fields = [
            { element: Input_Nome_ONG, errorElement: Campo_Erro_Nome_ONG },
            { element: Input_CNPJ, errorElement: Campo_Erro_CNPJ },
            { element: Input_Estado, errorElement: Campo_Erro_Estado },
            { element: Input_Cidade, errorElement: Campo_Erro_Cidade },
            { element: Input_Senha, errorElement: Campo_Errado_Senha },
            { element: Input_Telefone, errorElement: Campo_Errado_Telefone },
            { element: Input_Email, errorElement: Campo_Errado_Email },
            { element: Input_Tipo_ONG, errorElement: Campo_Errado_Tipo_ONG },
            { element: Input_Endereco, errorElement: Campo_Errado_Endereco },
            { element: Input_Confirmacao_de_senha, errorElement: Campo_Errado_Confirmar_Senha },
        ];

        fields.forEach(field => {
            field.element.style.border = "";
            field.errorElement.innerHTML = "";
        });

        if (!NOME_ONG) {
            Qnt_Campo_Errado++;
            Input_Nome_ONG.style.border = "1px solid red";
            Campo_Erro_Nome_ONG.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        const cnpjRegex = /^\d{14}$/;
        if (CNPJ) {
            if (!cnpjRegex.test(CNPJ)) {
                Qnt_Campo_Errado++;
                Input_CNPJ.style.border = "1px solid red";
                Campo_Erro_CNPJ.innerHTML = "CNPJ Invalido! Deve conter 14 digitos e apenas numeros!";
                event.preventDefault();
            }
        } else {
            Qnt_Campo_Errado++;
            Input_CNPJ.style.border = "1px solid red";
            Campo_Erro_CNPJ.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        if (ESTADO === "Selecione") {
            Qnt_Campo_Errado++;
            Input_Estado.style.border = "1px solid red";
            Campo_Erro_Estado.innerHTML = "Selecione uma opção!";
        }

        if (CIDADE === "Selecione") {
            Qnt_Campo_Errado++;
            Input_Cidade    .style.border = "1px solid red";
            Campo_Erro_Cidade.innerHTML = "Selecione uma opção!";
        }

        const senhaRegex = /^(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})/;
        if (SENHA) {
            if (!senhaRegex.test(SENHA)) {
                Qnt_Campo_Errado++;
                Input_Senha.style.border = "1px solid red";  
                Campo_Errado_Senha.innerHTML = "Senha inválida! Deve conter pelo menos 8 dígitos, 1 número e 1 caractere especial.";
                event.preventDefault();
            } 
        }
        else {
                Qnt_Campo_Errado++;
                Input_Senha.style.border = "1px solid red";
                Campo_Errado_Senha.innerHTML = "O campo não pode estar vazio!";
                event.preventDefault();
            }
        
        if (TELEFONE) {
            if(TELEFONE.length != 9) {
                Qnt_Campo_Errado++;
                    Input_Telefone.style.border = "1px solid red";
                    Campo_Errado_Telefone.innerHTML = "Telefone invalido! Deve conter 9 digitos e apenas numeros!";
                    event.preventDefault();
            }
        }
        else {
            Qnt_Campo_Errado++;
            Input_Telefone.style.border = "1px solid red";
            Campo_Errado_Telefone.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        if (EMAIL) {
            if (EMAIL.indexOf('@') === -1 || EMAIL.indexOf('.') === -1) {
                Qnt_Campo_Errado++;
                Input_Email.style.border = "1px solid red";
                Campo_Errado_Email.innerHTML = "E-mail inválido! Deve conter '@' e '.'";
                Campo_Errado_Email.style.display = "block";
                event.preventDefault();
            }
        } else {
            Qnt_Campo_Errado++;
            Input_Email.style.border = "1px solid red";
            Campo_Errado_Email.innerHTML = "O campo não pode estar vazio!";
            Campo_Errado_Email.style.display = "block";
            event.preventDefault();
        }

        if (TIPO_ONG === "Selecione") {
            Qnt_Campo_Errado++;
            Input_Tipo_ONG.style.border = "1px solid red";
            Campo_Errado_Tipo_ONG.innerHTML = "Selecione uma opção!";
            event.preventDefault();
        }

        if (!ENDERECO){
            Qnt_Campo_Errado++;
            Input_Endereco.style.border = "1px solid red";
            Campo_Errado_Endereco.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        if(CONFIRMACAO_SENHA){
            if(CONFIRMACAO_SENHA != SENHA){
                Qnt_Campo_Errado++;
                Input_Confirmacao_de_senha.style.border = "1px solid red";
                Campo_Errado_Confirmar_Senha.innerHTML = "Senhas não incompatíveis!";
                event.preventDefault();
            }
        }
        else{
            Qnt_Campo_Errado++;
            Input_Confirmacao_de_senha.style.border = "1px solid red";
            Campo_Errado_Confirmar_Senha.innerHTML = "O campo não pode estar vazio!";
            event.preventDefault();
        }

        if(Qnt_Campo_Errado == 0){
            
            fetch("/ONGs/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    NomeONG: NOME_ONG,
                    CNPJ: CNPJ,
                    Estado: ESTADO,
                    Cidade: CIDADE,
                    Senha: SENHA,
                    Telefone: TELEFONE,
                    Email: EMAIL,
                    TipoONG: TIPO_ONG,
                    Endereco: ENDERECO,
                    fkVoluntario: 1
                }),
                })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
                    finalizarAguardar();
                    } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                    finalizarAguardar();
                });

                return false;
    }     
}
</script>