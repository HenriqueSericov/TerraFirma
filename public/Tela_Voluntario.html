<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerraFirma</title>

    <!-- Adicione o link para a biblioteca do FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <link rel="icon" href="assets/icon/favicon-16x16.png" type="image/x-icon">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet" href="css/Tela_Voluntario.css">
</head>
<body onload="Inserir_Informacoes()">
    <div class="Menu_Lateral_Usuario" id="Menu_Lateral_Usuario">
        <div class="Sessao_Usuario">
            <div class="Header_Menu_Lateral">   
                    <div class="Div_Auxiliar"></div>
                    <img src="assets/imgs/Icone_Usuario.png" alt="" class="Imagem_Foto_de_Perfil">
                    <button class="Botao_Menu_Lateral" onclick="Fechar_Menu_Lateral()"><img src="assets/imgs/Icone_Fechar.png" alt="" class="Icone_Fechar"></button>
            </div>
            <p class="Nome_voluntario_Titulo" id="Nome_voluntario_Principal">SPTech Unidos</p>
        </div>
        <div class="Informações_Voluntarios">
            <p class="Nome_Voluntarios" id="Nome_Voluntario">Nome: </p>
            <p class="Email_Voluntarios" id="Email_Voluntario">Email: </p>
        </div>
        <div class="Sessao_TerraFirma">
            <img src="assets/imgs/Logo - TerraFirma.png" alt="" class="Logo_TerraFirma">
            <p class="Texto_TerraFirma">TerraFirma</p>
        </div>
        <button class="Botao_Sair" onclick="Sair()">
            <img src="assets/imgs/Icone_Sair.png" alt="" class="Icone_Sair">
            <p class="Texto_Sair">Sair</p>
        </button>
    </div>

    <div class="Campo_Aviso" id="Campo_Aviso">
        <div class="Conteudo_Aviso">
            <h1 class="Aviso" id="Aviso"></h1>
        </div>
    </div>

    <section class="Container_Modais" id="Container_Modais">

    </section>

    <header class="menu">
        <section>

        </section>
        <section class="sessao-logo-menu">
            <a href="">
                <img src="assets/imgs/Logo - TerraFirma.png" alt="Logo" class="logo-menu">
            </a>
            <p class="Titulo_TerraFirma">TerraFirma</p>
        </section>

        <a href="" class="Area_Botao_Usuario">
            <button  class="Botao_Usuario" onclick="Abrir_Menu_Lateral()">
                <img src="assets/imgs/Icone_Usuario.png" alt="Icone_Usuario" class="Icone_Usuario">
            </button>
        </a>            
    </header>

    <section class="Sessao_Inicial">
        <h1 class="Titulo_Pagina_Voluntario" id="Titulo_Pagina_Voluntario"></h1>
        <section class="Sessao_Categorias_de_vagas">
            <div class="Categorias">
                <h1 class="Titulo_Categorias" id="Sessao_Categorias_de_vagas">Categorias de vagas</h1>
                <div class="Tipos_Categoria">
                    <button class="Botao_Categoria" onclick="Buscar_Categoria_Alimeto()">
                        <img class="Img_Categoria" src="assets/imgs/Legenda_Alimento.png" alt="ODS Alimento">
                    </button>
                    <button class="Botao_Categoria" onclick="Buscar_Categoria_Servicos()">
                        <img class="Img_Categoria" src="assets/imgs/Legenda_Serviços.png" alt="ODS Limpeza">
                    </button>
                    <button class="Botao_Categoria" onclick="Buscar_Categoria_Educacao()">
                        <img class="Img_Categoria" src="assets/imgs/Legenda_Educação.png" alt="ODS Educação">
                    </button>
                    <button class="Botao_Categoria" onclick="Buscar_Categoria_Animais()">
                        <img class="Img_Categoria" src="assets/imgs/Legenda_Animais.png" alt="ODS Animais">
                    </button>
                    <button class="Botao_Categoria" onclick="Buscar_Categoria_Saude()">
                        <img class="Img_Categoria" src="assets/imgs/Legenda_Saude.png" alt="ODS Saude">
                    </button>
                    <button class="Botao_Categoria" onclick="Buscar_Categoria_Recreacao()">
                        <img class="Img_Categoria" src="assets/imgs/Legenda_Recreação.png" alt="ODS Recreação">
                    </button>
                </div>
                <button class="Botao_Suas_Inscricoes" onclick="Buscar_Inscricoes()">Suas Inscrições</button>
            </div>
        </section>
    </section>

    <div class="Sessao_Vagas">
        <h1 class="Titulo_Vagas" id="Titulo_Vagas">Selecione uma Categoria e encontre a vaga perfeita para voce!</h1>
        <div class="Vagas" id="Vagas">

        </div>
    </div>

    <Footer class="Footer">
        <div class="Conteudo_Footer">

                <img src="assets/imgs/Logo - TerraFirma.png" alt="Logo" class="logo-menu">

            <div class="Botoes_Footer">
                    <button class="Botao_Footer" onclick="Buscar_Categoria_Alimeto()">Alimento</button>

                    <button class="Botao_Footer" onclick="Buscar_Categoria_Servicos()">Serviços</button>

                    <button class="Botao_Footer" onclick="Buscar_Categoria_Educacao()">Educação</button>

                    <button class="Botao_Footer" onclick="Buscar_Categoria_Animais()">Animais</button>

                    <button class="Botao_Footer" onclick="Buscar_Categoria_Saude()">Saúde</button>
            </div>
        </div>
    </Footer>
</body>
</html>
<script>
    function Sair(){
            sessionStorage.clear();
            window.location = "Login_Voluntario.html";
    }

    function Abrir_Menu_Lateral(){
        Menu_Lateral_Usuario.style.display = "block"
        event.preventDefault();
    }

    function Fechar_Menu_Lateral(){
        Menu_Lateral_Usuario.style.display = "none"
    }
    
    function Inserir_Informacoes(){
        let Nome_Usuario = sessionStorage.NOME_USUARIO
        let Email_Usuario = sessionStorage.EMAIL_USUARIO

        Titulo_Pagina_Voluntario.innerHTML = `Bem vindo ${Nome_Usuario}!`
        Nome_Voluntario.innerHTML += `<br> ${Nome_Usuario}`
        Nome_voluntario_Principal.innerHTML = ` ${Nome_Usuario}`
        Email_Voluntario.innerHTML += `<br> ${Email_Usuario}`

    }

    function Fechar_Modal(IdModal){
        IdModal.style.display = "None"

    }

    function Abrir_Modal(IdModal){

        IdModal.style.display = "flex"
    }

    function Buscar_Categoria_Alimeto(){
        Titulo_Vagas.innerHTML = "Vagas relacionadas a Alimentos"
        const Categoria = "'Alimento'"

        Buscar_Todas_Ações_Por_Categoria(Categoria)
    }

    function Buscar_Categoria_Servicos(){
        Titulo_Vagas.innerHTML = "Vagas relacionadas a Serviços"
        const Categoria = "'Serviços'"

        Buscar_Todas_Ações_Por_Categoria(Categoria)
    }

    function Buscar_Categoria_Educacao(){
        Titulo_Vagas.innerHTML = "Vagas na área da Educação"
        const Categoria = "'Educação'"

        Buscar_Todas_Ações_Por_Categoria(Categoria)
    }

    function Buscar_Categoria_Animais(){
        Titulo_Vagas.innerHTML = "Vagas relacionadas a Animais"
        const Categoria = "'Animais'"

        Buscar_Todas_Ações_Por_Categoria(Categoria)
    }

    function Buscar_Categoria_Saude(){
        Titulo_Vagas.innerHTML = "Vagas na área da Saúde"
        const Categoria = "'Saude'"

        Buscar_Todas_Ações_Por_Categoria(Categoria)
    }

    function Buscar_Categoria_Recreacao(){
        Titulo_Vagas.innerHTML = "Vagas relacionadas a Recreação"
        const Categoria = "'Recreação'"

        Buscar_Todas_Ações_Por_Categoria(Categoria)
    }

    function Buscar_Inscricoes(){
        const fkVoluntario = sessionStorage.ID_USUARIO

        Titulo_Vagas.innerHTML = "Suas inscrições"

        fetch("ONGs/Buscar_Inscricoes", {
                method: "POST",
                headers: {
                        "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    fk_Voluntario: fkVoluntario
                })
                }).then(function (resposta) {
                console.log("ESTOU NO THEN DO Buscar_Inscricoes")

                if (resposta.ok) {
                        console.log(resposta);

                        resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        Vagas.innerHTML = ""
                        Container_Modais.innerHTML = ""
                        let Id_Modal = 0

                        for(let Posicao = 0; Posicao < json.length; Posicao++){
                                Id_Modal++
                                let Modal = `Modal${Id_Modal}`

                                const IdUsuario = sessionStorage.ID_USUARIO
                                const IdAcao = json[Posicao].IdAcao;
                                const Nome_da_Acao = json[Posicao].Nome_Acao;
                                const Data_da_Acao = json[Posicao].DataAcao;
                                const Data_Formatada = Data_da_Acao.split("T")[0];
                                const Descricao_Acao = json[Posicao].Descricao;
                                const Imagem_Acao = json[Posicao].URLImagem
                                const Nome_ONG = json[Posicao].Nome_ONG;
                                const Endereco = json[Posicao].Endereco;
                                const Nome_Estado = json[Posicao].Estado;
                                const Nome_Cidade = json[Posicao].Cidade;
                                const Nome_Zona = json[Posicao].Zona;

                                Vagas.innerHTML += `
                                <div class="Card" onclick="Abrir_Modal(${Modal})">
                                    <img class="Imagem_card" src="${Imagem_Acao}" alt="">
                                    <div class="Conteudo_Card">
                                        <h1 class="titulo_card">${Nome_da_Acao}</h1>
                                        <div class="Detalhes_Card">
                                            <section class="Localizacao-card">
                                                <span>📍</span>
                                                <p class="Cidade_Zona_Card_Acao">${Nome_Cidade}, ${Nome_Zona}</p>
                                            </section>
                                            <p class="Data_Acao">${Data_Formatada}</p>
                                        </div>
                                        <p class="Descricao_Acao">${Descricao_Acao}</p>
                                        <p class="Nome_ONG">ONG: ${Nome_ONG}</p>
                                    </div>
                                </div>
                                                `

                                Container_Modais.innerHTML += `
                                <div class="Modal_Acao" id="${Modal}">
                                    <div class="Conteudo_Modal">
                                        <div class="Cabecalo_Modal">
                                            <div class="Div_Auxilar_Modal"></div>
                                            <h1 class="Nome_Acao_Modal">${Nome_da_Acao}</h1>
                                            <button class="Botao_Fechar" onclick="Fechar_Modal(${Modal})">
                                                <span class="Icone_Fechar_Modal">&times;</span>
                                            </button>
                                        </div>
                                        <div class="Detalhes_Acao">
                                            <div class="Descricao_Acao_Modal">
                                                <h4 class="Titulo_Descricao_Modal">Sobre a ação</h4>
                                                <p class="Texto_Descricao_Modal">${Descricao_Acao}</p>
                                            </div>
                                            <div class="Informacoes_Acoes">
                                                <p class="Info_Acao"><span class="Titulo_Info">Local:</span><br> <span class="Local_Acao_Modal">${Nome_Cidade}, ${Nome_Zona}</span>📍</p>
                                                <p class="Info_Acao"><span class="Titulo_Info">Endereço:</span><br> ${Endereco}</p>
                                                <p class="Info_Acao"><span class="Titulo_Info">Data:</span><br>  <span class="Data_Acao_Modal">${Data_Formatada}</span></p>
                                                <p class="Info_Acao"><span class="Titulo_Info">ONG:</span><br> ${Nome_ONG}</p>
                                            </div>
                                            <div class="Caixa_Imagem">
                                                <img src="${Imagem_Acao}" alt="" class="Imagem_Acao_Modal">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                `
                        }

                        });

                } else {
                        resposta.text().then(texto => {
                        console.error(texto);;
                        });
                }

                }).catch(function (erro) {
                console.log(erro);
                })

                return false;
    }

    function Buscar_Todas_Ações_Por_Categoria(Categoria_Acao){

        fetch("ONGs/Buscar_Todas_Acoes_Por_Categoria", {
                method: "POST",
                headers: {
                        "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    Categoria: Categoria_Acao
                })
                }).then(function (resposta) {
                console.log("ESTOU NO THEN DO BUSCAR ACOES!")

                if (resposta.ok) {
                        console.log(resposta);

                        resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        Vagas.innerHTML = ""
                        Container_Modais.innerHTML = ""
                        let Id_Modal = 0

                        for(let Posicao = 0; Posicao < json.length; Posicao++){
                                Id_Modal++
                                let Modal = `Modal${Id_Modal}`

                                const IdUsuario = sessionStorage.ID_USUARIO
                                const IdAcao = json[Posicao].IdAcao;
                                const Nome_da_Acao = json[Posicao].Nome_Acao;
                                const Data_da_Acao = json[Posicao].DataAcao;
                                const Data_Formatada = Data_da_Acao.split("T")[0];
                                const Descricao_Acao = json[Posicao].Descricao;
                                const Imagem_Acao = json[Posicao].URLImagem
                                const Nome_ONG = json[Posicao].Nome_ONG;
                                const Endereco = json[Posicao].Endereco;
                                const Nome_Estado = json[Posicao].Estado;
                                const Nome_Cidade = json[Posicao].Cidade;
                                const Nome_Zona = json[Posicao].Zona;

                                Vagas.innerHTML += `
                                <div class="Card" onclick="Abrir_Modal(${Modal})">
                                    <img class="Imagem_card" src="${Imagem_Acao}" alt="">
                                    <div class="Conteudo_Card">
                                        <h1 class="titulo_card">${Nome_da_Acao}</h1>
                                        <div class="Detalhes_Card">
                                            <section class="Localizacao-card">
                                                <span>📍</span>
                                                <p class="Cidade_Zona_Card_Acao">${Nome_Cidade}, ${Nome_Zona}</p>
                                            </section>
                                            <p class="Data_Acao">${Data_Formatada}</p>
                                        </div>
                                        <p class="Descricao_Acao">${Descricao_Acao}</p>
                                        <p class="Nome_ONG">ONG: ${Nome_ONG}</p>
                                    </div>
                                </div>
                                                `

                                Container_Modais.innerHTML += `
                                <div class="Modal_Acao" id="${Modal}">
                                    <div class="Conteudo_Modal">
                                        <div class="Cabecalo_Modal">
                                            <div class="Div_Auxilar_Modal"></div>
                                            <h1 class="Nome_Acao_Modal">${Nome_da_Acao}</h1>
                                            <button class="Botao_Fechar" onclick="Fechar_Modal(${Modal})">
                                                <span class="Icone_Fechar_Modal">&times;</span>
                                            </button>
                                        </div>
                                        <div class="Detalhes_Acao">
                                            <div class="Descricao_Acao_Modal">
                                                <h4 class="Titulo_Descricao_Modal">Sobre a ação</h4>
                                                <p class="Texto_Descricao_Modal">${Descricao_Acao}</p>
                                            </div>
                                            <div class="Informacoes_Acoes">
                                                <p class="Info_Acao"><span class="Titulo_Info">Local:</span><br> <span class="Local_Acao_Modal">${Nome_Cidade}, ${Nome_Zona}</span>📍</p>
                                                <p class="Info_Acao"><span class="Titulo_Info">Endereço:</span><br> ${Endereco}</p>
                                                <p class="Info_Acao"><span class="Titulo_Info">Data:</span><br>  <span class="Data_Acao_Modal">${Data_Formatada}</span></p>
                                                <p class="Info_Acao"><span class="Titulo_Info">ONG:</span><br> ${Nome_ONG}</p>
                                            </div>
                                            <div class="Caixa_Imagem">
                                                <img src="${Imagem_Acao}" alt="" class="Imagem_Acao_Modal">
                                            </div>
                                        </div>
                                        <button class="Botao_Inscreva-se" onclick="Participar_Acao(${IdAcao}, ${IdUsuario}, ${Modal})">Increver-se</button>
                                    </div>
                                </div>
                                `
                        }

                        });

                } else {
                        resposta.text().then(texto => {
                        console.error(texto);;
                        });
                }

                }).catch(function (erro) {
                console.log(erro);
                })

                return false;
    }

    function Participar_Acao(fkAcao, IdUsuario, IdModal) {
        event.preventDefault();
        fetch("Voluntarios/Cadastrar_Participacao", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                    body: JSON.stringify({
                        fk_Acao: fkAcao,
                        Id_Usuario: IdUsuario
                    }),
                })
                    .then(function (resposta) {
                            console.log("resposta: ", resposta);

                            if (resposta.ok) {

                                IdModal.style.display = "none"
                                Aviso.style.color = "#00ff2a"
                                Campo_Aviso.style.display = "flex"
                                Aviso.innerHTML = "Inscrição Realizada com sucesso!"
                                setTimeout(() => {
                                    Campo_Aviso.style.display = "none"
                                }, 2500);

                            } else {
                                console.log("Erro ao Realizar Cadastro")

                                IdModal.style.display = "none"
                                Campo_Aviso.style.display = "flex"
                                Aviso.style.color = "red"
                                Aviso.innerHTML = "Voce já está Inscrito nessa Ação!"
                                setTimeout(() => {
                                    Campo_Aviso.style.display = "none"
                                }, 2500);
                            }
                        })
                        .catch(function (resposta) {
                            console.log(`#ERRO: ${resposta}`);
                        });

                return false;
    }
</script>